# Windows based test
# Tests a UI Automation scenario with Windows MCP Server
# https://windowsmcpserver.dev/
# https://github.com/sbroenne/mcp-windows
#
# Testing framework: Agent Benchmark
# https://github.com/mykhaliev/agent-benchmark
#
# Test: Complete Notepad workflow with proof
# Success = proof provided + Notepad closed
#
# Prerequisites:
# - Windows 10/11
# - Windows MCP Server executable in examples folder
# - Environment variables set:
#   - AZURE_OPENAI_ENDPOINT: Azure OpenAI endpoint
#   - AZURE_OPENAI_API_KEY: Azure OpenAI API key
#
# Run command:
#   go run . -f examples/windows-mcp-server-test.yaml -reportType html,json

criteria:
  success_rate: 1 # 100%

providers:
  - name: azure-openai-gpt41
    type: AZURE
    token: "{{AZURE_OPENAI_API_KEY}}"
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview

  - name: azure-openai-gpt4o
    type: AZURE
    token: "{{AZURE_OPENAI_API_KEY}}"
    model: gpt-4o
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview

servers:
  - name: windows-mcp
    type: stdio
    command: ./examples/Sbroenne.WindowsMcp.exe
    server_delay: 10s

agents:
  - name: gpt41-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt41

  - name: gpt4o-agent
    servers:
      - name: windows-mcp
    provider: azure-openai-gpt4o

settings:
  verbose: true
  max_iterations: 10      # launch + type + close + dialog + verify + buffer
  test_delay: 10s         # Longer delay to avoid rate limits between agents

sessions:
  - name: Notepad Workflow
    tests:
      - name: "Complete Notepad automation"
        description: "Open Notepad, type text, close without saving"
        prompt: |
          1. Launch Notepad
          2. Type "Hello World"
          3. Record proof that this worked (no screenshots, just text)
          4. Close Notepad and click "Don't Save" if prompted
          5. Verify no Notepad window is open (search for it)
          
          Report "VERIFIED: No Notepad window open" if closed successfully.
        assertions:
          # OUTCOME: LLM verified no Notepad window open
          - type: output_regex
            pattern: "(?i)(no.*(notepad|window).*(open|found|running)|verified|notepad.*(closed|not found))"

          # OUTCOME: Proof that "Hello World" was typed
          - type: output_regex
            pattern: "(?i)hello\\s*world"

          # SAFETY: No failure indicators
          - type: output_not_contains
            value: "failed"

          # QUALITY: Only used real tools
          - type: no_hallucinated_tools

          # QUALITY: No errors during execution
          - type: no_error_messages

          # REQUIRED: Must use window_management to launch/close/find windows
          - type: tool_called
            tool: window_management

          # VERIFY: Notepad was launched with correct program
          - type: tool_param_equals
            tool: window_management
            params:
              action: "launch"
              programPath: "notepad.exe"

          # VERIFY: Launch succeeded (ok: true in JSON response)
          - type: tool_result_matches_json
            tool: window_management
            path: "$.ok"
            value: true

          # PERFORMANCE: Complete within 60 seconds
          - type: max_latency_ms
            value: 60000
          
          # EFFICIENCY: Stay under token limits
          - type: max_tokens
            value: 60000

